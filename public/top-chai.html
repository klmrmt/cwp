<!DOCTYPE html>
<html lang="en">
<head>
	<title>Table V04</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="perfect-scrollbar/perfect-scrollbar.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main-table.css">
  	<link rel="stylesheet" type="text/css" href="css/top-chai.css">
<!--===============================================================================================-->
	<script src="/socket.io/socket.io.js"></script>
  	<script src="./js/responder.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-light" style="padding-top: 0; padding-bottom: 0;">
    <a class="navbar-brand" href="#"><img class="logo-nav" src="images/logo-blue.png" alt=""></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about-chai.html">About Papa</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="search.html">General Search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="search-advanced.html">Advanced Search</a>
        </li>
      </ul>
    </div>
  </nav>
  <!--  -->
	<div class="limiter">
		<div class="container-table100">
			<div class="wrap-table100">
				<div class="table100 ver2 m-b-110">
					<div class="table100-head">
						<table>
							<thead>
								<tr class="row100 head">
									<th class="cell100 column1">Title</th>
									<th class="cell100 column2">Rating</th>
									<th class="cell100 column3">Chai Rating</th>
								</tr>
							</thead>
						</table>
					</div>

					<div class="table100-body js-pscroll">
						<table>
							<tbody id="searchTable">
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- footer -->
    <footer class="footer" style="margin-top: 25px; padding-top: 25px; padding-bottom: 25px;">
      <div class="container">
        <a href="#"><p class="p1 afooter">Terms & Conditions </p></a>
        <a href="#"><p class="p1 afooter">Privacy Terms</p></a>

      </div>
    </footer>

<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			var ps = new PerfectScrollbar(this);

			$(window).on('resize', function(){
				ps.update();
			})
		});


	</script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>
	<script type="text/javascript">
		var url = window.location.href;
		var arr = url.split("/");
		var result = arr[0] + "//" + arr[2];
		const socket = io.connect(result);
		const topCategory = url.split("#");

		const searchTypes = {
			'indian_art_house': {'prod_Art_House': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'indian_documentaries': {'indian_doc': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'indian_short_doc': {'indian_short_doc': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'indian_short_movie': {'indian_short_movie': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'indian_tv_series': {'indian_tv': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'indian_commercial_movies': {'indian_movie': true, 'prod_commercial': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'english_tv_series': {'english_tv': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
			'english_commercial_movies': {'english_tv': true, 'prod_commercial': true, 'top_ranked_yes': true, 'noneChecked': false, 'allChecked': true},
		}

		let object = searchTypes[topCategory[1]];
		socket.emit('advanced_search', object);
		socket.on('advanced_search_response', function(data) {
			var map = new Map();
            data.forEach((result) => {
              result.forEach((entry) => {
                map.set(entry[0], entry[1]);
              })
            });
            setGlobalMap(map);
            setTableData(getGlobalMap());
		});

		function setTableData(map) {
            document.getElementById('searchTable').innerHTML = ''
            const _mapArr = Array.from(map);
            for (let i = 0; i < _mapArr.length; i++) {
              var tableNode = document.createElement('tr');
              tableNode.setAttribute('class', 'row100 body');
              tableNode.setAttribute('id',_mapArr[i][0])
              tableNode.setAttribute('onclick','openTitleWindow(this.id)');
              var tableText1 = document.createElement('td');
              tableText1.setAttribute('class', 'cell100 column1');
              var tableText2 = document.createElement('td');
              tableText2.setAttribute('class', 'cell100 column2');
              var tableText3 = document.createElement('td');
              tableText3.setAttribute('class', 'cell100 column3');
              tableText1.innerHTML = _mapArr[i][1].title;
              if (_mapArr[i][1].imdb_rating != null) {
                tableText2.innerHTML = _mapArr[i][1].imdb_rating;
              } else {
                tableText2.innerHTML = 'Not Rated';
              }

              if (_mapArr[i][1].cwp_rating != null) {
                tableText3.innerHTML = _mapArr[i][1].cwp_rating;
              } else {
                tableText3.innerHTML = 'Not Rated';
              }
              tableNode.appendChild(tableText1);
              tableNode.appendChild(tableText2);
              tableNode.appendChild(tableText3);
              document.getElementById('searchTable').appendChild(tableNode);
            }
		  }
		  
		  function openTitleWindow(id) {
            setGlobalObjectFromID(id);
            let map = getGlobalObject();
            let url = './title-page.html#' + id.toString();
            window.location.replace(url);
          }
	
	</script>

</body>
</html>
